# 智慧农业数据监控大屏（ECharts）开发流程

## 1. 项目概述
- **目标**: 基于 ECharts 搭建智慧农业实时监控大屏，展示气象环境、土壤/作物、灌溉设备、病虫害预警、产量与物流等数据。
- **特点**: 深色大屏、全屏自适应、实时刷新、跨图联动、异常预警。

## 2. 技术栈与环境
- **前端**: Vue 3 + Vite + TypeScript + Vue Router + ECharts 6 + D3（可选数据预处理）。
- **后端/数据源（可选）**: Express 5（本仓库已含）或对接现有数据平台/物联网平台。
- **Node 版本**: ^20.19.0 或 >=22.12.0（与 package.json engines 一致）。

## 3. 目录与模块规划
建议结构（仅展示与大屏相关的新增部分）：
```
src/
  views/
    Dashboard/
      index.vue            # 大屏主视图（布局栅格、全屏、自适应）
      components/
        CardWrapper.vue    # 统一卡片容器（标题、工具区、Skeleton）
        Chart*
          EnvOverview.vue  # 环境概览（温湿度、风速、光照）
          SoilMoisture.vue # 土壤墒情地图/热力图
          Irrigation.vue   # 灌溉设备状态/用水量
          PestAlert.vue    # 病虫害预警趋势/告警列表
          Yield.vue        # 产量/品类占比、环比同比
          Logistics.vue    # 物流在途/仓储占比
  services/
    api.ts                 # 统一请求封装（REST/WebSocket）
  stores/                  # 可选：Pinia 状态（若引入）
  utils/
    resize.ts              # ECharts 自适应与防抖
    theme.ts               # 自定义主题与色板
  styles/
    dashboard.scss         # 大屏通用样式
```

## 4. 设计规范
- **画布尺寸**: 1920×1080 设计稿，按比例缩放（容器 scale）。
- **色彩**: 深色背景 + 高饱和强调色；提供亮/暗两套主题变量。
- **字体**: 数字等宽字体优先；标题 18–24px，正文 12–14px。
- **状态**: 正常/预警/告警三态，颜色一致性与可达性对比度。

## 5. 数据对接
- 协议：REST（定时轮询）或 WebSocket（准实时推送）。
- 统一约定响应结构：`{ code, message, data, ts }`。
- 时间同步与时区：服务端时间为准，前端统一格式化。
- 异常处理：超时/断线/数据缺失回退策略与兜底 UI。

## 6. 图表清单与指标
- 环境概览：温度/湿度/风速/光照/气压（仪表盘或小型图）。
- 土壤墒情：地块分布热力图/分级填色地图 + 趋势线。
- 灌溉设备：在线数/工作状态堆叠柱状 + 用水量曲线。
- 病虫害预警：预警级别堆叠面积 + 实时告警列表。
- 产量与品类：环形玫瑰图 + 柱状/折线对比（同比/环比）。
- 物流与库存：在途地图迁徙 + 仓储占比仪表/条形图。

## 7. 开发流程
1) 初始化与依赖
   - 确认 `echarts@^6`、`vue@^3` 已安装。
   - 若需要实时：增加 WebSocket 客户端或使用现有库。

2) 路由与布局
   - 新增 `Dashboard/index.vue`，配置到 `router/index.ts`。
   - 实现大屏 3×3 或自定义栅格布局（CSS Grid/Flex）。
   - 支持全屏切换与容器缩放（按窗口宽高比缩放）。

3) 主题与样式
   - 定义主题色板与 ECharts 主题，统一注册与切换。
   - 卡片容器统一：标题、时间、刷新、筛选器、骨架屏。

4) ECharts 基础封装
   - 编写通用 `useEchart` 组合式函数：初始化、resize、销毁。
   - 统一 `setOption` 策略与防抖 resize（监听容器/窗口）。

5) 组件开发（逐块）
   - 以“数据契约（props）+ 纯配置（option builder）”模式开发。
   - 先静态数据调试，确认样式与交互，再接真实数据。

6) 数据层
   - `services/api.ts` 封装：基础请求、轮询器、错误重试。
   - DTO 与类型定义；必要时做数据清洗与计算（可用 D3）。

7) 联动与交互
   - ECharts `dispatchAction`、`on('mouseover/click')` 跨图联动。
   - 选择地块/设备时，联动更新相关图表与列表。

8) 性能优化
   - 减少重绘：数据 diff、懒加载、`setOption` 局部更新。
   - 大数据启用 `large`/`progressive`；压缩数据传输。

9) 监控与日志
   - 控制台告警统一前缀；埋点：加载时长、接口失败率。
   - 页面心跳与 WS 断线重连告警。

10) 构建与部署
   - 使用 Vite 构建；区分 `dev/staging/prod` 环境变量。
   - Nginx 静态托管，开启 gzip/brotli；缓存与版本指纹。

11) 运维与配置
   - 可配置刷新频率、数据阈值（预警/告警阈值）、主题。
   - 记录变更日志与版本号（见下）。

## 8. 质量保障
- 代码规范：ESLint/Prettier（可按需引入）；TypeScript 严格模式。
- 分支策略：`main`（稳定）/`dev`（集成）/`feat/*`（功能）。
- 提交规范：`feat/fix/docs/chore/refactor/perf/test` + 简述。
- 测试：关键 option builder 的单元测试；图表快照（可选）。
- CI/CD：安装、构建、静态检查与预览部署（可选）。

## 9. 安全与合规
- 接口鉴权/签名，避免在前端暴露密钥；敏感字段脱敏。
- CORS 与速率限制；错误信息不暴露实现细节。

## 10. 版本与里程碑
- v0.1 原型：完成布局 + 2 个核心图 + 假数据演示。
- v0.2 数据：接入环境与灌溉实时数据，完成 5 个图。
- v0.3 联动：完成地块/设备联动与预警机制。
- v1.0 发布：全图完成、性能优化、部署上线。

## 11. 验收标准（示例）
- 首屏加载 < 2.5s（本地网络）；图表更新延迟 < 1s。
- 各模块在 1366×768 至 4K 分辨率下无布局错乱。
- 断线重连与异常数据有明确提示与降级 UI。

## 12. 开发命令
```bash
npm run dev       # 启动开发
npm run build     # 生产构建
npm run preview   # 本地预览构建产物
```

## 13. 后续可拓展
- 多大屏路由/多地块切换、多语言、导出报表、权限控制等。


